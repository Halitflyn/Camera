<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–∫–∞–ª—å–Ω–∞ –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 20px;
            background-color: #f4f4f9;
            color: #333;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–µ–∫—Ü—ñ—ó –∫–∞–º–µ—Ä–∏ */
        #camera-setup {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #video-stream {
            width: 100%;
            max-width: 640px;
            height: auto;
            border: 2px solid #007bff;
            border-radius: 4px;
            display: block;
            margin: 0 auto 20px;
        }

        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #capture-button {
            background-color: #28a745;
            color: white;
        }
        #capture-button:hover {
            background-color: #218838;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≥–∞–ª–µ—Ä–µ—ó */
        #gallery-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding-top: 20px;
        }

        .photo-card {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            width: 220px; /* –¢—Ä–æ—Ö–∏ –±—ñ–ª—å—à–µ, –Ω—ñ–∂ –º—ñ–Ω—ñ–∞—Ç—é—Ä–∞ */
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .photo-card img {
            width: 200px; /* –ú—ñ–Ω—ñ–∞—Ç—é—Ä–∞ */
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .photo-card .photo-title {
            font-weight: bold;
            margin-bottom: 10px;
            word-break: break-all;
            text-align: center;
        }

        .photo-card .actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        .actions .delete-btn { background-color: #dc3545; color: white; }
        .actions .delete-btn:hover { background-color: #c82333; }
        .actions .edit-btn { background-color: #ffc107; color: #333; }
        .actions .edit-btn:hover { background-color: #e0a800; }
        .actions .move-btn { background-color: #007bff; color: white; }
        .actions .move-btn:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <h1>üì∏ –õ–æ–∫–∞–ª—å–Ω–∞ –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</h1>

    <div id="camera-setup">
        <h2>1. –ó—Ä–æ–±–∏—Ç–∏ –§–æ—Ç–æ</h2>
        <video id="video-stream" autoplay playsinline></video>
        <canvas id="canvas-capture" style="display:none;"></canvas>

        <button id="capture-button" disabled>–ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ</button>
    </div>

    <hr>

    <div id="gallery-section">
        <h2>2. –í–∞—à–∞ –ì–∞–ª–µ—Ä–µ—è</h2>
        <div id="gallery-container">
            <p id="no-photos-message">–£ –≥–∞–ª–µ—Ä–µ—ó –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Ñ–æ—Ç–æ. –ó—Ä–æ–±—ñ—Ç—å –ø–µ—Ä—à–∏–π –∑–Ω—ñ–º–æ–∫!</p>
        </div>
    </div>

    <script>
        // –Ü–º–µ–Ω–∞ —Å—Ö–æ–≤–∏—â
        const STORAGE_KEY = 'localPhotoGallery';
        
        // DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
        const video = document.getElementById('video-stream');
        const canvas = document.getElementById('canvas-capture');
        const captureButton = document.getElementById('capture-button');
        const galleryContainer = document.getElementById('gallery-container');
        const noPhotosMessage = document.getElementById('no-photos-message');

        // --- 1. –î–û–°–¢–£–ü –î–û –ö–ê–ú–ï–†–ò –Ü –ó–ô–û–ú–ö–ê ---

        async function startCamera() {
            try {
                // –ó–∞–ø–∏—Ç—É—î–º–æ –¥–æ—Å—Ç—É–ø –¥–æ –≤—ñ–¥–µ–æ
                const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                video.srcObject = stream;
                // –ß–µ–∫–∞—î–º–æ, –ø–æ–∫–∏ –≤—ñ–¥–µ–æ –ø–æ—á–Ω–µ –≥—Ä–∞—Ç–∏
                await video.play();
                captureButton.disabled = false;
                captureButton.textContent = '–ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ';
                console.log('–ö–∞–º–µ—Ä–∞ —É—Å–ø—ñ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞.');
            } catch (err) {
                console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏: ', err);
                captureButton.textContent = '–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ üòü';
                alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–∑–≤–æ–ª–∏.');
            }
        }

        function capturePhoto() {
            // –í—Å—Ç–∞–Ω–æ–≤–ª—é—î–º–æ —Ä–æ–∑–º—ñ—Ä–∏ canvas –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ —Ä–æ–∑–º—ñ—Ä—ñ–≤ –≤—ñ–¥–µ–æ
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            // –ú–∞–ª—é—î–º–æ –ø–æ—Ç–æ—á–Ω–∏–π –∫–∞–¥—Ä –Ω–∞ canvas
            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            // –û—Ç—Ä–∏–º—É—î–º–æ Data URL (Base64) –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
            // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ 'image/jpeg' –¥–ª—è –º–µ–Ω—à–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É —Ñ–∞–π–ª—É
            const photoDataURL = canvas.toDataURL('image/jpeg', 0.9); 

            // –°—Ç–≤–æ—Ä—é—î–º–æ –æ–±'—î–∫—Ç —Ñ–æ—Ç–æ –∑ –Ω–∞–∑–≤–æ—é —Ç–∞ Data URL
            const photo = {
                id: Date.now(), // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID
                name: `–§–æ—Ç–æ-${new Date().toLocaleTimeString('uk-UA')}`,
                data: photoDataURL
            };

            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–∞ –æ–Ω–æ–≤–ª—é—î–º–æ –≥–∞–ª–µ—Ä–µ—é
            savePhoto(photo);
            renderGallery();

            alert('–§–æ—Ç–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        }

        captureButton.addEventListener('click', capturePhoto);
        window.addEventListener('load', startCamera);

        // --- 2. –†–û–ë–û–¢–ê –ó LOCAL STORAGE ---

        function getPhotos() {
            const photosJSON = localStorage.getItem(STORAGE_KEY);
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ –º–∞—Å–∏–≤, —è–∫—â–æ —î –¥–∞–Ω—ñ, –∞–±–æ –ø–æ—Ä–æ–∂–Ω—ñ–π –º–∞—Å–∏–≤
            return photosJSON ? JSON.parse(photosJSON) : []; 
        }

        function savePhotos(photosArray) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(photosArray));
        }

        function savePhoto(newPhoto) {
            const photos = getPhotos();
            // –î–æ–¥–∞—î–º–æ –Ω–æ–≤–µ —Ñ–æ—Ç–æ –Ω–∞ –ø–æ—á–∞—Ç–æ–∫ –º–∞—Å–∏–≤—É (—â–æ–± –Ω–æ–≤—ñ –±—É–ª–∏ –ø–µ—Ä—à–∏–º–∏)
            photos.unshift(newPhoto); 
            savePhotos(photos);
        }

        // --- 3. –û–ù–û–í–õ–ï–ù–ù–Ø –ì–ê–õ–ï–†–ï–á –¢–ê –§–£–ù–ö–¶–Ü–û–ù–ê–õ ---

        function renderGallery() {
            const photos = getPhotos();
            galleryContainer.innerHTML = ''; // –û—á–∏—â–∞—î–º–æ –≥–∞–ª–µ—Ä–µ—é

            if (photos.length === 0) {
                noPhotosMessage.style.display = 'block';
                return;
            } else {
                noPhotosMessage.style.display = 'none';
            }

            photos.forEach((photo, index) => {
                const card = createPhotoCard(photo, index, photos.length);
                galleryContainer.appendChild(card);
            });
        }

        function createPhotoCard(photo, index, totalPhotos) {
            const card = document.createElement('div');
            card.className = 'photo-card';
            card.dataset.id = photo.id;
            
            card.innerHTML = `
                <div class="photo-title">${photo.name}</div>
                <img src="${photo.data}" alt="${photo.name}">
                <div class="actions">
                    <button class="edit-btn">üìù –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                    <button class="delete-btn">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    <button class="move-btn" data-direction="left" ${index === 0 ? 'disabled' : ''}>‚óÄÔ∏è</button>
                    <button class="move-btn" data-direction="right" ${index === totalPhotos - 1 ? 'disabled' : ''}>‚ñ∂Ô∏è</button>
                </div>
            `;
            
            // –î–æ–¥–∞—î–º–æ –æ–±—Ä–æ–±–Ω–∏–∫–∏ –ø–æ–¥—ñ–π
            card.querySelector('.delete-btn').addEventListener('click', () => deletePhoto(photo.id));
            card.querySelector('.edit-btn').addEventListener('click', () => editPhotoName(photo.id, photo.name));
            card.querySelectorAll('.move-btn').forEach(btn => {
                btn.addEventListener('click', (e) => movePhoto(photo.id, e.target.dataset.direction));
            });

            return card;
        }

        // --- 4. –§–£–ù–ö–¶–Ü–û–ù–ê–õ: –í–ò–î–ê–õ–ï–ù–ù–Ø, –†–ï–î–ê–ì–£–í–ê–ù–ù–Ø, –ü–ï–†–ï–ú–Ü–©–ï–ù–ù–Ø ---

        function deletePhoto(id) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ —Ñ–æ—Ç–æ?')) {
                let photos = getPhotos();
                // –§—ñ–ª—å—Ç—Ä—É—î–º–æ –º–∞—Å–∏–≤, –∑–∞–ª–∏—à–∞—é—á–∏ –ª–∏—à–µ —Ç—ñ —Ñ–æ—Ç–æ, ID —è–∫–∏—Ö –Ω–µ –∑–±—ñ–≥–∞—î—Ç—å—Å—è –∑ –≤–∏–¥–∞–ª—è—î–º–∏–º
                photos = photos.filter(photo => photo.id !== id);
                savePhotos(photos);
                renderGallery();
            }
        }

        function editPhotoName(id, currentName) {
            const newName = prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–∞–∑–≤—É –¥–ª—è —Ñ–æ—Ç–æ:', currentName);
            if (newName && newName.trim() !== currentName) {
                let photos = getPhotos();
                const photoIndex = photos.findIndex(photo => photo.id === id);

                if (photoIndex !== -1) {
                    photos[photoIndex].name = newName.trim();
                    savePhotos(photos);
                    renderGallery();
                }
            }
        }

        function movePhoto(id, direction) {
            let photos = getPhotos();
            const photoIndex = photos.findIndex(photo => photo.id === id);

            if (photoIndex === -1) return;

            let newIndex = photoIndex;

            if (direction === 'left' && photoIndex > 0) {
                newIndex = photoIndex - 1;
            } else if (direction === 'right' && photoIndex < photos.length - 1) {
                newIndex = photoIndex + 1;
            } else {
                return; // –ù—ñ–∫—É–¥–∏ –ø–µ—Ä–µ–º—ñ—â–∞—Ç–∏
            }

            // –ó–º—ñ–Ω—é—î–º–æ –µ–ª–µ–º–µ–Ω—Ç–∏ –º—ñ—Å—Ü—è–º–∏: [a, b] -> [b, a]
            [photos[photoIndex], photos[newIndex]] = [photos[newIndex], photos[photoIndex]];

            savePhotos(photos);
            renderGallery();
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≥–∞–ª–µ—Ä–µ—ó –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.addEventListener('load', renderGallery);

    </script>
</body>
</html>
