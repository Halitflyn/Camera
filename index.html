<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–æ–∫–∞–ª—å–Ω–∞ –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f9;
            color: #333;
            text-align: center;
        }

        h1 {
            color: #007bff;
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è —Å–µ–∫—Ü—ñ—ó –∫–∞–º–µ—Ä–∏ */
        #camera-setup {
            margin-bottom: 40px;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        #video-stream {
            width: 100%;
            max-width: 640px;
            height: auto;
            border: 2px solid #007bff;
            border-radius: 4px;
            display: block;
            margin: 0 auto 20px;
        }
        
        #controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #capture-button {
            background-color: #28a745;
            color: white;
            padding: 12px 25px; 
            font-size: 18px;
        }
        #capture-button:hover {
            background-color: #218838;
        }
        
        /* –°—Ç–∏–ª—ñ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∫–∞–º–µ—Ä–∏ (–¥–æ–ø–æ–º—ñ–∂–Ω–∏–π —Å—Ç–∏–ª—å) */
        #switch-camera-button {
            background-color: #6c757d; 
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px 12px; 
            font-size: 14px; 
        }
        #switch-camera-button:hover {
            background-color: #5a6268;
        }
        
        /* –°—Ç–∏–ª—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —ñ–∫–æ–Ω–æ–∫ */
        #switch-camera-button span {
            display: inline-flex;
            margin-right: 8px;
            transition: transform 0.3s ease;
        }

        /* –ï—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–Ω—è: —ñ–∫–æ–Ω–∫–∞ "–æ–±–µ—Ä—Ç–∞—î—Ç—å—Å—è" –Ω–∞ 180 –≥—Ä–∞–¥—É—Å—ñ–≤ */
        #switch-camera-button:hover span {
            transform: rotate(180deg); 
        }

        /* –°—Ç–∏–ª—ñ –¥–ª—è –≥–∞–ª–µ—Ä–µ—ó */
        #gallery-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            padding-top: 20px;
        }

        .photo-card {
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 8px;
            padding: 10px;
            width: 220px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .photo-card img {
            width: 200px; 
            height: 200px;
            object-fit: cover;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .photo-card .photo-title {
            font-weight: bold;
            margin-bottom: 10px;
            word-break: break-all;
            text-align: center;
        }

        .photo-card .actions {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .actions button {
            padding: 5px 10px;
            font-size: 12px;
        }
        .actions .delete-btn { background-color: #dc3545; color: white; }
        .actions .delete-btn:hover { background-color: #c82333; }
        .actions .edit-btn { background-color: #ffc107; color: #333; }
        .actions .edit-btn:hover { background-color: #e0a800; }
        .actions .move-btn { background-color: #007bff; color: white; }
        .actions .move-btn:hover { background-color: #0056b3; }
    </style>
</head>
<body>

    <h1>üì∏ –õ–æ–∫–∞–ª—å–Ω–∞ –§–æ—Ç–æ–≥–∞–ª–µ—Ä–µ—è</h1>
    
    <hr>

    <div id="camera-setup">
        <h2>1. –ö–∞–º–µ—Ä–∞</h2>
        
        <video id="video-stream" autoplay playsinline></video>
        <canvas id="canvas-capture" style="display:none;"></canvas>

        <div id="controls">
            <button id="capture-button" disabled>–ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ</button>
            
            <button id="switch-camera-button" disabled>
                <span id="camera-icon">
                    </span>
                <span id="camera-label">–ü–µ—Ä–µ–º–∫–Ω—É—Ç–∏ –∫–∞–º–µ—Ä—É</span>
            </button>
        </div>
    </div>

    <hr>

    <div id="gallery-section">
        <h2>2. –í–∞—à–∞ –ì–∞–ª–µ—Ä–µ—è</h2>
        <div id="gallery-container">
            <p id="no-photos-message">–£ –≥–∞–ª–µ—Ä–µ—ó –ø–æ–∫–∏ —â–æ –Ω–µ–º–∞—î —Ñ–æ—Ç–æ. –ó—Ä–æ–±—ñ—Ç—å –ø–µ—Ä—à–∏–π –∑–Ω—ñ–º–æ–∫!</p>
        </div>
    </div>

    <script>
        // –Ü–º–µ–Ω–∞ —Å—Ö–æ–≤–∏—â
        const STORAGE_KEY = 'localPhotoGallery';
        
        // DOM-–µ–ª–µ–º–µ–Ω—Ç–∏
        const video = document.getElementById('video-stream');
        const canvas = document.getElementById('canvas-capture');
        const captureButton = document.getElementById('capture-button');
        const switchCameraButton = document.getElementById('switch-camera-button');
        const cameraIconSpan = document.getElementById('camera-icon');
        const cameraLabelSpan = document.getElementById('camera-label');
        const galleryContainer = document.getElementById('gallery-container');
        const noPhotosMessage = document.getElementById('no-photos-message');

        let currentCameraId = null;
        let cameras = [];

        // --- SVG –Ü–ö–û–ù–ö–ò ---
        
        const CAMERA_SVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"></path><circle cx="12" cy="13" r="4"></circle></svg>';
        const SWITCH_SVG = '<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20M17 5H7l-3 3m10 8h6l-3 3"></path><circle cx="12" cy="13" r="4"></circle></svg>';


        // --- –§–£–ù–ö–¶–Ü–Ø –û–ù–û–í–õ–ï–ù–ù–Ø –Ü–ö–û–ù–ö–ò ---

        function updateCameraIcon(currentDeviceId) {
            const currentCam = cameras.find(cam => cam.deviceId === currentDeviceId);
            const isFrontActive = currentCam ? (currentCam.label.toLowerCase().includes('front') || currentCam.label.toLowerCase().includes('user')) : false;

            if (isFrontActive) {
                // –Ø–∫—â–æ –∞–∫—Ç–∏–≤–Ω–∞ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞, –ø—Ä–æ–ø–æ–Ω—É—î–º–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–Ω—É
                cameraIconSpan.innerHTML = SWITCH_SVG;
                cameraLabelSpan.textContent = '–û—Å–Ω–æ–≤–Ω–∞'; 
            } else {
                // –Ø–∫—â–æ –∞–∫—Ç–∏–≤–Ω–∞ –æ—Å–Ω–æ–≤–Ω–∞, –ø—Ä–æ–ø–æ–Ω—É—î–º–æ –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É
                cameraIconSpan.innerHTML = CAMERA_SVG;
                cameraLabelSpan.textContent = '–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞'; 
            }
        }

        // --- 1. –î–û–°–¢–£–ü –î–û –ö–ê–ú–ï–†–ò –Ü –ó–ô–û–ú–ö–ê ---

        async function getCameras() {
            try {
                await navigator.mediaDevices.getUserMedia({ video: true }); 
                const devices = await navigator.mediaDevices.enumerateDevices();
                cameras = devices.filter(device => device.kind === 'videoinput');

                if (cameras.length > 1) {
                    switchCameraButton.disabled = false;
                } else {
                    switchCameraButton.disabled = true;
                }
                
                // === –ù–û–í–ê –õ–û–ì–Ü–ö–ê –ü–†–Ü–û–†–ò–¢–ï–¢–£ –°–ï–õ–§–Ü-–ö–ê–ú–ï–†–Ü ===
                // 1. –°–ø—Ä–æ–±—É–≤–∞—Ç–∏ –∑–Ω–∞–π—Ç–∏ –∫–∞–º–µ—Ä—É –∑ –ø–æ–∑–Ω–∞—á–∫–æ—é 'front' –∞–±–æ 'user'
                const frontCamera = cameras.find(cam => cam.label.toLowerCase().includes('front') || cam.label.toLowerCase().includes('user'));
                
                // 2. –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ ID —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ—ó –∫–∞–º–µ—Ä–∏, —è–∫—â–æ –≤–æ–Ω–∞ –∑–Ω–∞–π–¥–µ–Ω–∞, —ñ–Ω–∞–∫—à–µ - –ø–µ—Ä—à—É –≤ —Å–ø–∏—Å–∫—É
                currentCameraId = frontCamera ? frontCamera.deviceId : (cameras[0] ? cameras[0].deviceId : null);
                
            } catch (err) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ —Å–ø–∏—Å–∫—É –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ –∞–±–æ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏: ', err);
            }
        }

        async function startCamera() {
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => track.stop());
            }

            const constraints = {
                video: {
                    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ ID, —è–∫–∏–π –±—É–≤ –≤–∏–∑–Ω–∞—á–µ–Ω–∏–π —è–∫ ID —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ—ó –∫–∞–º–µ—Ä–∏
                    deviceId: currentCameraId ? { exact: currentCameraId } : undefined 
                }
            };
            
            if (!currentCameraId && cameras.length === 0) {
                 constraints.video = true;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                video.srcObject = stream;
                await video.play();
                captureButton.disabled = false;
                captureButton.textContent = '–ó—Ä–æ–±–∏—Ç–∏ —Ñ–æ—Ç–æ';
                
                const track = stream.getVideoTracks()[0];
                const settings = track.getSettings();
                
                // –û–Ω–æ–≤–ª—é—î–º–æ ID –ø–æ—Ç–æ—á–Ω–æ—ó –∫–∞–º–µ—Ä–∏ (–Ω–∞ –≤–∏–ø–∞–¥–æ–∫, —è–∫—â–æ browser –≤–∏–±—Ä–∞–≤ —ñ–Ω—à—É)
                currentCameraId = settings.deviceId;
                
                updateCameraIcon(currentCameraId);

            } catch (err) {
                console.error('–ù–µ –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏: ', err);
                captureButton.textContent = '–ö–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞ üòü';
                alert('–ü–æ–º–∏–ª–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –∫–∞–º–µ—Ä–∏. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –¥–æ–∑–≤–æ–ª–∏.');
            }
        }

        function switchCamera() {
            if (cameras.length < 2) return;

            const currentIndex = cameras.findIndex(cam => cam.deviceId === currentCameraId);
            const nextIndex = (currentIndex + 1) % cameras.length;
            currentCameraId = cameras[nextIndex].deviceId;

            startCamera();
        }

        function capturePhoto() {
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;

            const context = canvas.getContext('2d');
            context.drawImage(video, 0, 0, canvas.width, canvas.height);

            const photoDataURL = canvas.toDataURL('image/jpeg', 0.8); 

            const photo = {
                id: Date.now(),
                name: `–§–æ—Ç–æ-${new Date().toLocaleTimeString('uk-UA')}`,
                data: photoDataURL
            };

            savePhoto(photo);
            renderGallery();

            alert('–§–æ—Ç–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
        }

        captureButton.addEventListener('click', capturePhoto);
        switchCameraButton.addEventListener('click', switchCamera);


        // --- 2. –†–û–ë–û–¢–ê –ó LOCAL STORAGE ---

        function getPhotos() {
            const photosJSON = localStorage.getItem(STORAGE_KEY);
            return photosJSON ? JSON.parse(photosJSON) : []; 
        }

        function savePhotos(photosArray) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(photosArray));
        }

        function savePhoto(newPhoto) {
            const photos = getPhotos();
            photos.unshift(newPhoto); 
            savePhotos(photos);
        }

        // --- 3. –û–ù–û–í–õ–ï–ù–ù–Ø –ì–ê–õ–ï–†–ï–á –¢–ê –§–£–ù–ö–¶–Ü–û–ù–ê–õ ---

        function renderGallery() {
            const photos = getPhotos();
            galleryContainer.innerHTML = ''; 

            if (photos.length === 0) {
                noPhotosMessage.style.display = 'block';
                return;
            } else {
                noPhotosMessage.style.display = 'none';
            }

            photos.forEach((photo, index) => {
                const card = createPhotoCard(photo, index, photos.length);
                galleryContainer.appendChild(card);
            });
        }

        function createPhotoCard(photo, index, totalPhotos) {
            const card = document.createElement('div');
            card.className = 'photo-card';
            card.dataset.id = photo.id;
            
            card.innerHTML = `
                <div class="photo-title">${photo.name}</div>
                <img src="${photo.data}" alt="${photo.name}">
                <div class="actions">
                    <button class="edit-btn">üìù –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</button>
                    <button class="delete-btn">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
                    <button class="move-btn" data-direction="left" ${index === 0 ? 'disabled' : ''}>‚óÄÔ∏è</button>
                    <button class="move-btn" data-direction="right" ${index === totalPhotos - 1 ? 'disabled' : ''}>‚ñ∂Ô∏è</button>
                </div>
            `;
            
            card.querySelector('.delete-btn').addEventListener('click', () => deletePhoto(photo.id));
            card.querySelector('.edit-btn').addEventListener('click', () => editPhotoName(photo.id, photo.name));
            card.querySelectorAll('.move-btn').forEach(btn => {
                btn.addEventListener('click', (e) => movePhoto(photo.id, e.target.dataset.direction));
            });

            return card;
        }

        function deletePhoto(id) {
            if (confirm('–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü–µ —Ñ–æ—Ç–æ?')) {
                let photos = getPhotos();
                photos = photos.filter(photo => photo.id !== id);
                savePhotos(photos);
                renderGallery();
            }
        }

        function editPhotoName(id, currentName) {
            const newName = prompt('–í–≤–µ–¥—ñ—Ç—å –Ω–æ–≤—É –Ω–∞–∑–≤—É –¥–ª—è —Ñ–æ—Ç–æ:', currentName);
            if (newName && newName.trim() !== currentName) {
                let photos = getPhotos();
                const photoIndex = photos.findIndex(photo => photo.id === id);

                if (photoIndex !== -1) {
                    photos[photoIndex].name = newName.trim();
                    savePhotos(photos);
                    renderGallery();
                }
            }
        }

        function movePhoto(id, direction) {
            let photos = getPhotos();
            const photoIndex = photos.findIndex(photo => photo.id === id);

            if (photoIndex === -1) return;

            let newIndex = photoIndex;

            if (direction === 'left' && photoIndex > 0) {
                newIndex = photoIndex - 1;
            } else if (direction === 'right' && photoIndex < photos.length - 1) {
                newIndex = photoIndex + 1;
            } else {
                return;
            }

            [photos[photoIndex], photos[newIndex]] = [photos[newceivedIndex], photos[photoIndex]];

            savePhotos(photos);
            renderGallery();
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        window.addEventListener('load', async () => {
            await getCameras();
            // StartCamera —Ç–µ–ø–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î ID —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ—ó –∫–∞–º–µ—Ä–∏, —è–∫—â–æ –≤—ñ–Ω –¥–æ—Å—Ç—É–ø–Ω–∏–π
            startCamera(); 
            renderGallery();
        });

    </script>
</body>
</html>
